<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Создание договора</title>
  <!-- Подключение библиотек -->
  <script src="https://cdn.jsdelivr.net/npm/html-docx-js/dist/html-docx.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver/dist/FileSaver.min.js"></script>
  <link rel="stylesheet" href="index.css" />
</head>
<body>
<h1>Форма для создания договора</h1>
<form id="contractForm">
  <!-- Название услуги -->
  <label>
    <p> Наименование услуги:</p>
    <input type="text" id="serviceName" placeholder="Наименование" required>
  </label>
  <br><br>
  <!-- Дата -->
  <label>
    <p>Дата (день месяц год):</p>
    <input type="date" id="date" required>
  </label>
  <br><br>
  <!-- Количество -->
  <label>
    <p> Количество:</p>
    <input type="number" id="quantity" min="0" required>
  </label>
  <br><br>
  <!-- Единица измерения -->
  <label>
    <p>Единица измерения:</p>
    <select id="unit" required>
      <option value="т">т</option>
      <option value="м3">м3</option>
    </select>
  </label>
  <br><br>
  <!-- Сумма -->
  <label>
    <p> Сумма (руб):</p>
    <input type="number" id="amount" min="0" required>
  </label>
  <br><br>
  <!-- Заказчик -->
  <label>
    <p>Заказчик имя:</p>
    <input type="text" id="customer" placeholder="Иванов И И" required>
  </label>
  <br><br>
  <!-- Адрес -->
  <label>
    <p> Адрес:</p>
    <input type="text" id="address" placeholder="Новотрактовая, 13" required>
  </label>
  <br><br>
  <!-- Телефон заказчика -->
  <label>
    <p>Телефон заказчика:</p>
    <input type="tel" id="customerPhone" placeholder="8-900-00-00" required>
  </label>
  <br><br>
  <!-- Кнопки -->
  <button type="button" onclick="generateAndDownload()">Создать договор (скачать)</button>
  <button type="button" onclick="generateAndOpen()">Открыть договор в новом окне</button>
</form>
<script>
function generateAndDownload() {
  // Получение данных из формы
  const serviceName = document.getElementById('serviceName').value.trim();
  const dateInput = document.getElementById('date').value;
  const quantity = document.getElementById('quantity').value;
  const unit = document.getElementById('unit').value;
  const amount = document.getElementById('amount').value;
  const customer = document.getElementById('customer').value.trim();
  const address = document.getElementById('address').value.trim();
  const customerPhone = document.getElementById('customerPhone').value.trim();

  // Проверка даты
  const dateObj = new Date(dateInput);
  if (isNaN(dateObj)) {
    alert('Пожалуйста, выберите правильную дату.');
    return;
  }

  // Форматирование даты для заголовка
  const options = { day: 'numeric', month: 'long', year: 'numeric' };
  const formattedDate = dateObj.toLocaleDateString('ru-RU', options);

  const day = dateObj.getDate();
  const monthLong = dateObj.toLocaleString('ru-RU', { month: 'long' });
  const year = dateObj.getFullYear();

  const htmlContent = `
<h2 style="text-align:center;">АКТ №     1     ОТ       ${day}  ${monthLong}  ${year}г.</h2>
<p>Исполнитель ИП Михайлов Александр Андреевич <br>
ИНН 590613985887 ОГРНИП 305590609000010 тел.271-81-41</p>
<table style="width:100%; border-collapse: collapse; margin-top:10px;">
<tr>
  <td style="width:50%; vertical-align: top;">
    <p>Заказчик: ${customer}      ${address}</p>
  </td>
  <td style="width:50%; vertical-align: top; text-align:right;">
    <p>Телефон заказчика: ${customerPhone}</p>
  </td>
</tr>
</table>

<table style="width:100%; border-collapse: collapse; margin-top:10px;" border="1" cellpadding="5" cellspacing="0">
<tr>
  <th>№</th>
  <th>Наименование</th>
  <th>Кол-во</th>
  <th>Ед.</th>
  <th>Сумма, руб.</th>
</tr>
<tr>
  <td>1</td>
  <td>${serviceName}</td>
  <td>${quantity}</td>
  <td>${unit}</td>
  <td>${amount}</td>
</tr>
</table>

<table style="width:100%; border-collapse: collapse; margin-top:10px;" border="0" cellpadding="5" cellspacing="0">
<tr>
  <td style="width:50%;"></td>
  <td style="width:50%; text-align:right;">Сумма с учетом скидки при предоставлении карты №  ____  5%</td>
</tr>
<tr>
  <td style="width:50%;"></td>
  <td style="width:50%; text-align:right;">Итого: <u> ${amount} </u></td>
</tr>
<tr>
  <td style="width:50%;"></td>
  <td style="width:50%; text-align:right;">Без НДС  <u> ${amount} </u></td>
</tr>
</table>

<p>Всего оказано услуг на сумму: <u> ${amount} </u> руб.</p>
<p>Вышеперечисленные услуги выполнены полностью и в срок. Заказчик претензий по объему, качеству и срокам оказания услуг не имеет.</p>

<p>ВОДИТЕЛЬ ____________________________</p>
<p>ИСПОЛНИТЕЛЬ ЛОГИСТ ____________________________</p>
<p>________________________________________</p>
<p>ЗАКАЗЧИК ____________________________</p>

<p>*Просим ответить на вопрос ниже:</p>
<p>Откуда узнали информацию о нашей компании?</p>
<p>__________________________________________________</p>

<p>Перевод  8- 908-271-81-41 Александр Андреевич М.( Сбербанк)</p>
`;

  // Создаем Blob
  const blob = htmlDocx.asBlob(htmlContent);
  // Сохраняем файл
  saveAs(blob, `Акт_${formattedDate}.docx`);
}

function generateAndOpen() {
  // Получение данных из формы
  const serviceName = document.getElementById('serviceName').value.trim();
  const dateInput = document.getElementById('date').value;
  const quantity = document.getElementById('quantity').value;
  const unit = document.getElementById('unit').value;
  const amount = document.getElementById('amount').value;
  const customer = document.getElementById('customer').value.trim();
  const address = document.getElementById('address').value.trim();
  const customerPhone = document.getElementById('customerPhone').value.trim();

  const dateObj = new Date(dateInput);
  if (isNaN(dateObj)) {
    alert('Пожалуйста, выберите правильную дату.');
    return;
  }

  const options = { day: 'numeric', month: 'long', year: 'numeric' };
  const formattedDate = dateObj.toLocaleDateString('ru-RU', options);
  const day = dateObj.getDate();
  const monthLong = dateObj.toLocaleString('ru-RU', { month: 'long' });
  const year = dateObj.getFullYear();

  const htmlContent = `
<h2 style="text-align:center;">АКТ №     1     ОТ       ${day}  ${monthLong}  ${year}г.</h2>
<p>Исполнитель ИП Михайлов Александр Андреевич <br>
ИНН 590613985887 ОГРНИП 305590609000010 тел.271-81-41</p>
<table style="width:100%; border-collapse: collapse; margin-top:10px;">
<tr>
  <td style="width:50%; vertical-align: top;">
    <p>Заказчик: ${customer}      ${address}</p>
  </td>
  <td style="width:50%; vertical-align: top; text-align:right;">
    <p>Телефон заказчика: ${customerPhone}</p>
  </td>
</tr>
</table>

<table style="width:100%; border-collapse: collapse; margin-top:10px;" border="1" cellpadding="5" cellspacing="0">
<tr>
  <th>№</th>
  <th>Наименование</th>
  <th>Кол-во</th>
  <th>Ед.</th>
  <th>Сумма, руб.</th>
</tr>
<tr>
  <td>1</td>
  <td>${serviceName}</td>
  <td>${quantity}</td>
  <td>${unit}</td>
  <td>${amount}</td>
</tr>
</table>

<table style="width:100%; border-collapse: collapse; margin-top:10px;" border="0" cellpadding="5" cellspacing="0">
<tr>
  <td style="width:50%;"></td>
  <td style="width:50%; text-align:right;">Сумма с учетом скидки при предоставлении карты №  ____  5%</td>
</tr>
<tr>
  <td style="width:50%;"></td>
  <td style="width:50%; text-align:right;">Итого: <u> ${amount} </u></td>
</tr>
<tr>
  <td style="width:50%;"></td>
  <td style="width:50%; text-align:right;">Без НДС  <u> ${amount} </u></td>
</tr>
</table>

<p>Всего оказано услуг на сумму: <u> ${amount} </u> руб.</p>
<p>Вышеперечисленные услуги выполнены полностью и в срок. Заказчик претензий по объему, качеству и срокам оказания услуг не имеет.</p>

<p>ВОДИТЕЛЬ ____________________________</p>
<p>ИСПОЛНИТЕЛЬ ЛОГИСТ ____________________________</p>
<p>________________________________________</p>
<p>ЗАКАЗЧИК ____________________________</p>

<p>*Просим ответить на вопрос ниже:</p>
<p>Откуда узнали информацию о нашей компании?</p>
<p>__________________________________________________</p>

<p>Перевод  8- 908-271-81-41 Александр Андреевич М.( Сбербанк)</p>
`;

  const blob = htmlDocx.asBlob(htmlContent);
  const url = URL.createObjectURL(blob);
  window.open(url, '_blank');
}
</script>
</body>
</html>